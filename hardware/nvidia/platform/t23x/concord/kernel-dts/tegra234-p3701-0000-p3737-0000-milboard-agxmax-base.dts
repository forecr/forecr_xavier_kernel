/*
 * Top level DTS file for CVM:P3701-0000 and CVB:MILBOARD-AGXMAX.
 *
 * Copyright (c) 2021-2023, NVIDIA CORPORATION.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 */

/dts-v1/;
#include "tegra234-p3701-0000-prod.dtsi"
#include "cvm/tegra234-p3701-0000.dtsi"
#include "cvb/tegra234-p3737-0000-a04-mgbe.dtsi"
#include "tegra234-power-tree-p3701-0000-p3737-0000.dtsi"
#include "tegra234-dcb-p3701-0000-a02-p3737-0000-a01_hdmi.dtsi"
#include <tegra234-soc/mods-simple-bus.dtsi>
//#include "cvb/tegra234-p3737-camera-modules.dtsi"
#include "cvb/tegra234-p3737-0000-camera-expansion-forecr-a00.dtsi"
#include <t234-common-cvb/tegra234-pwm.dtsi>
#include <t234-common-cvm/tegra234-cpuidle.dtsi>
#include <t234-common-cvm/tegra234-thermal.dtsi>
#include <t234-common-cvm/tegra234-thermal-cooling.dtsi>
#include <t234-common-cvm/tegra234-thermal-userspace-alert.dtsi>
#include <tegra234-soc/tegra234-soc-hwpm.dtsi>

/ {
	nvidia,dtsfilename = __FILE__;
	nvidia,dtbbuildtime = __DATE__, __TIME__;
	model = "AGX Orin for MILBOARD-AGXMAX";
	compatible = "nvidia,p3737-0000+p3701-0000", "nvidia,p3701-0000", "nvidia,tegra234", "nvidia,tegra23x";

	aliases {
		rtc2 = "/i2c@3160000/pcf8523@68";
	};

	fixed-regulators {
		p3737_vdd_3v3_pcie: regulator@105 {
			/delete-property/ regulator-boot-on;
			/delete-property/ gpio;
			/delete-property/ enable-active-low;
			regulator-always-on;
		};
		p3737_vdd_12v_pcie: regulator@114 {
			/delete-property/ regulator-boot-on;
			/delete-property/ gpio;
			/delete-property/ enable-active-low;
			regulator-always-on;
		};
	};

	serial@3100000 { // UART1
		status = "okay";
	};

	serial@3140000 { // UART2
		status = "okay";
	};

	serial@3130000 { // UART4
		status = "okay";
	};

	serial@3110000 { // UART5
		status = "okay";
	};

	i2c@c240000 {
		ucsi_ccg@8 {
			status = "disabled";
			connector@0 {
				/delete-node/ port;
			};

			connector@1 {
				/delete-node/ port;
			};
		};
	};

	i2c@3190000 {
		tca9535_22: tca9535@22 {
			compatible = "nxp,pca9535";
			reg = <0x22>;
			gpio-controller;
			#gpio-cells = <2>;
			gpio-line-names = 
			    "SERIAL_CH0.RS485/RS232#",
			    "SERIAL_CH0.TERM",
			    "SERIAL_CH1.RS485/RS232#",
			    "SERIAL_CH1.TERM",
			    "SERIAL_CH2.RS485/RS232#",
			    "SERIAL_CH2.TERM",
			    "SERIAL_CH3.RS485/RS232#",
			    "SERIAL_CH3.TERM",
			    "DIGITAL_IO_CH0",
			    "DIGITAL_IO_CH1",
			    "DIGITAL_IO_CH2",
			    "DIGITAL_IO_CH3",
			    "DIGITAL_IO_CH4",
			    "DIGITAL_IO_CH5",
			    "DIGITAL_IO_CH6",
			    "DIGITAL_IO_CH7";

			/*
			serial_default_config {
				gpio-hog;
				gpios = <0 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0>;
				output-low; // for RS232
				//output-high; // for RS422
			};
			*/
		};
	};

	i2c@3160000 {
		status = "okay";

		// 0x68 - PCF8523 RTC
		pcf8523@68 {
			status = "okay";
			compatible = "nxp,pcf8523";
			reg = <0x68>;
		};

		// 0x56 - EEPROM CAT24C04WI-GT3
		// 0x6B - 2536030320001 6-AXIS IMU & TEMP SENSOR
	};

	spi@3210000 {
		status = "okay";

		spi@0 {
			status = "okay";
			compatible = "tegra-spidev";
			reg = <0x0>;
			spi-max-frequency = <20000000>;

			controller-data {
				nvidia,enable-hw-based-cs;
				nvidia,rx-clk-tap-delay = <0x10>;
				nvidia,tx-clk-tap-delay = <0x0>;
			};
		};
	};

	pcie@14180000 { // PCIe x1 (C0) - Ethernet
		status = "okay";
		phys = <&p2u_hsio_0>;
		phy-names = "p2u-0";
		nvidia,max-speed = <2>; // i210 is GEN2
	};

	pcie@14100000 { // PCIe x1 (C1) - Ethernet
		status = "okay";
		nvidia,max-speed = <2>; // i210 is GEN2
	};

	pcie@14160000 { //* PCIe x4 (C4) - M.2 Key-M
		status = "okay";
	};

	pcie@141a0000 { // PCIe x8 (C5) - M.2 Key-M
		status = "okay";
		/delete-property/ vpcie3v3-supply;
		/delete-property/ vpcie12v-supply;
	};

	/* PCIe x8 (C7) */
	pcie@141e0000 { 
		status = "disabled";
	};

	/* MGBE - A */
	ethernet@6810000 {
		status = "okay";
	};

	ethernet@6910000 {
		status = "disabled";
	};

	ethernet@6A10000 {
		status = "disabled";
	};

	ethernet@6B10000 {
		status = "disabled";
	};

	/* EQOS */
	ethernet@2310000 {
		status = "okay";

		nvidia,mac-addr-idx = <0>;
		nvidia,pause_frames = <1>;
		local-mac-address = [1a 2b 3c 4d 5e 6f];
		nvidia,phy-reset-gpio = <&tegra_main_gpio TEGRA234_MAIN_GPIO(G, 5) 0>;
		phy-mode = "rgmii-id";
		phy-handle = <&phy>;
		nvidia,max-platform-mtu = <16383>; //8000

		mdio {
			compatible = "nvidia,eqos-mdio";
			#address-cells = <1>;
			#size-cells = <0>;

			phy: phy@0 {
				reg = <0>; //<1>;
				nvidia,phy-rst-pdelay-msec = <224>; /* msec */
				nvidia,phy-rst-duration-usec = <10000>; /* usec */
				interrupt-parent = <&tegra_main_gpio>;
				interrupts = <TEGRA234_MAIN_GPIO(G, 4) IRQ_TYPE_LEVEL_LOW>;
				marvell,copper-mode;
				/* Setup LED[2] as interrupt pin (active low) */
				marvell,reg-init = <0x03 0x12 0x7fff 0x880>;
			};
		};
	};

	fixed-regulators {
		regulator@3 {
			regulator-boot-on;
		};
	};

	xusb_padctl@3520000 {
		ports {
			usb2-0 {
				status = "okay";
				vbus-supply = <&battery_reg>;
				mode = "otg";
				usb-role-switch;
				/delete-node/ port;
				connector {
					compatible = "usb-b-connector", "gpio-usb-b-connector";
					label = "micro-USB";
					type = "micro";
					vbus-gpios = <&tegra_main_gpio TEGRA234_MAIN_GPIO(Z, 1) GPIO_ACTIVE_LOW>;
				};
			};
			usb2-3 {
				status = "okay";
				vbus-supply = <&battery_reg>;
				mode = "host";
			};
		};
	};

	xudc@3550000 {
		/delete-property/ charger-detector;
	};

	/delete-node/ tegra_usb_cd;

	nvsciipc-kernel {
		compatible = "nvidia,nvsciipc";
		status = "okay";
	};

	firmware {
		android {
			compatible = "android,firmware";
			first_stage_delay = "1";
			system_root_blkdev = "/dev/mmcblk0p1";
			fstab {
				compatible = "android,fstab";
				vendor {
					compatible = "android,vendor";
					dev = "/dev/block/platform/3460000.sdhci/by-name/vendor";
					type = "ext4";
					mnt_flags = "ro,noatime";
					fsmgr_flags = "wait";
				};
			};
		};
	};

	display@13800000 {
		status = "okay";
	};

	dce@d800000 {
		status = "okay";
	};

	bpmp {
		i2c {
			tegra_tmp451: temp-sensor@4c {
				vdd-supply = <&p3737_vdd_1v8_sys>;

				ext {
					shutdown-limit = <107>;
				};
			};

			vrs11_1@20 {
				compatible = "nvidia,vrs11";
				reg = <0x20>;
				rail-name-loopA = "GPU";
				rail-name-loopB = "CPU";
				status = "okay";
			};

			vrs11_2@22 {
				compatible = "nvidia,vrs11";
				reg = <0x22>;
				rail-name-loopA = "SOC";
				rail-name-loopB = "CV";
				status = "okay";
			};
		};
	};

	reserved-memory {
		linux,cma {
			status = "okay";
		};
	};

	tegra_soc_hwpm {
		status = "okay";
	};

	tegra-hsp@3d00000 {
		status = "okay";
	};

	aon@c000000 {
		status = "okay";
	};

	cpu_alert: cpu-throttle-alert {
		status = "okay";
	};

	gpu_alert: gpu-throttle-alert {
		status = "okay";
	};

	cv0_alert: cv0-throttle-alert {
		status = "okay";
	};

	cv1_alert: cv1-throttle-alert {
		status = "okay";
	};

	cv2_alert: cv2-throttle-alert {
		status = "okay";
	};

	soc0_alert: soc0-throttle-alert {
		status = "okay";
	};

	soc1_alert: soc1-throttle-alert {
		status = "okay";
	};

	soc2_alert: soc2-throttle-alert {
		status = "okay";
	};

	hot_surface_alert: hot-surface-alert {
		status = "okay";
	};

	stm@24080000 {
		status = "disabled";
	};

	cpu0_etm@27040000 {
		status = "disabled";
	};

	cpu1_etm@27140000 {
		status = "disabled";
	};

	cpu2_etm@27240000 {
		status = "disabled";
	};

	cpu3_etm@27340000 {
		status = "disabled";
	};

	cpu4_etm@27440000 {
		status = "disabled";
	};

	cpu5_etm@27540000 {
		status = "disabled";
	};

	cpu6_etm@27640000 {
		status = "disabled";
	};

	cpu7_etm@27740000 {
		status = "disabled";
	};

	cpu8_etm@27840000 {
		status = "disabled";
	};

	cpu9_etm@27940000 {
		status = "disabled";
	};

	cpu10_etm@27A40000 {
		status = "disabled";
	};

	cpu11_etm@27B40000 {
		status = "disabled";
	};

	funnel_ccplex0@26030000 {
		status = "disabled";
	};

	funnel_ccplex1@26040000 {
		status = "disabled";
	};

	funnel_ccplex2@26050000 {
		status = "disabled";
	};

	funnel_top_ccplex@26020000 {
		status = "disabled";
	};

	funnel_major@24040000 {
		status = "disabled";
	};

	replicator@24060000 {
		status = "disabled";
	};

	etf@24050000 {
		status = "disabled";
	};

	etr@24070000 {
		status = "disabled";
	};

	serial@31d0000 {
		status = "okay";
	};
};
